{"version":3,"sources":["../../src/controllers/contourMap_ctrl.js"],"names":["MetricsPanelCtrl","_","d3","L","TileServers","isobands","ContourMapCtrl","$scope","$injector","ctrl","events","on","onInitEditMode","bind","onPanelTeardown","onRender","onPanelInitialized","onDataRecieved","onDataError","onRefresh","panel","tileServer","undefined","maxZoom","Options","options","minZoom","zoomLevel","lockMap","maxLongitude","maxLatitude","minLatitude","minLongitude","useReferenceValue","referencePointTag","useAngleMean","angleMeanTimeWindow","showLegend","useGradient","gradientBreakCount","gradientStart","gradientEnd","gradientStartColor","gradientEndColor","gradientSigFigs","metaData","data","circleMarkers","contourLayers","mapContainer","legend","addEditorTab","console","log","map","off","height","row","render","createMap","editMode","datasource","getMetaData","x","pointtag","join","then","JSON","parse","each","element","index","list","datam","find","y","PointTag","datapoints","length","Value","pop","plotSites","plotContour","msg","mapOptions","zoomControl","attributionControl","boxZoom","doubleClickZoom","dragging","zoomDelta","id","tileLayer","url","addTo","updateMapView","event","getZoom","bounds","getBounds","_southWest","lng","_northEast","lat","refresh","radius","stroke","color","weight","opacity","lineCap","lineJoin","dashArray","dashOffset","fill","fillColor","fillOpacity","fillRule","bubblingMouseEvents","renderer","className","a","removeFrom","push","circleMarker","Latitude","Longitude","m","$","_container","n","width","values","Array","parseInt","toFixed","geoJson","createGeoJson","isoband","properties","breaks","geoJSON","style","feature","addLegend","remove","control","position","onAdd","div","DomUtil","create","labels","features","colors","i","innerHTML","setZoom","fitBounds","markerGroup","featureGroup","isValid","min","max","step","input","average","reduce","b","minLng","minLat","maxLng","maxLat","gridN","gridM","nStep","Math","abs","mStep","scaleLinear","domain","range","interpolate","interpolateCubehelixLong","styles","j","wzSum","wSum","pow","getDistanceFromLatLonInKm","value","lat1","lon1","lat2","lon2","R","dLat","deg2rad","dLon","sin","cos","c","atan2","sqrt","d","deg","PI","templateUrl"],"mappings":"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","file":"contourMap_ctrl.js","sourcesContent":["﻿//******************************************************************************************************\r\n//  contourMap_ctrl.ts - Gbtc\r\n//\r\n//  Copyright © 2017, Grid Protection Alliance.  All Rights Reserved.\r\n//\r\n//  Licensed to the Grid Protection Alliance (GPA) under one or more contributor license agreements. See\r\n//  the NOTICE file distributed with this work for additional information regarding copyright ownership.\r\n//  The GPA licenses this file to you under the MIT License (MIT), the \"License\"; you may not use this\r\n//  file except in compliance with the License. You may obtain a copy of the License at:\r\n//\r\n//      http://opensource.org/licenses/MIT\r\n//\r\n//  Unless agreed to in writing, the subject software distributed under the License is distributed on an\r\n//  \"AS-IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. Refer to the\r\n//  License for the specific language governing permissions and limitations.\r\n//\r\n//  Code Modification History:\r\n//  ----------------------------------------------------------------------------------------------------\r\n//  11/08/2017 - Billy Ernest\r\n//       Generated original version of source code.\r\n//\r\n//******************************************************************************************************\r\n\r\nimport { MetricsPanelCtrl } from 'app/plugins/sdk'\r\n\r\nimport _ from 'lodash';\nimport d3 from \"d3\";\n\nimport * as L from 'leaflet';\r\nimport './../css/leaflet.css!';\n\nimport { TileServers } from './../js/constants';\nimport isobands from \"@turf/isobands\"\n\r\nexport class ContourMapCtrl extends MetricsPanelCtrl {\r\n    constructor($scope, $injector) {\r\n        super($scope, $injector);\r\n\r\n        var ctrl = this;\r\n\r\n        this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\r\n        this.events.on('panel-teardown', this.onPanelTeardown.bind(this));\r\n        this.events.on('render', this.onRender.bind(this));\r\n        this.events.on('panel-initialized', this.onPanelInitialized.bind(this));\r\n        this.events.on('data-received', this.onDataRecieved.bind(this));\r\n        //this.events.on('data-snapshot-load', console.log('data-snapshot-load'));\r\n        this.events.on('data-error', this.onDataError.bind(this));\r\n        this.events.on('refresh', this.onRefresh.bind(this));\n\r\n\r\n        // Variables for options\r\n        ctrl.TileServers = TileServers;\r\n        ctrl.panel.tileServer = (ctrl.panel.tileServer != undefined ? ctrl.panel.tileServer: TileServers[0]);\r\n        ctrl.panel.maxZoom = (ctrl.panel.tileServer.Options.options.maxZoom != undefined ? ctrl.panel.tileServer.Options.options.maxZoom : 18)\r\n        ctrl.panel.minZoom = (ctrl.panel.tileServer.Options.options.minZoom != undefined ? ctrl.panel.tileServer.Options.options.minZoom : 2)\r\n        ctrl.panel.zoomLevel = (ctrl.panel.zoomLevel != undefined ? ctrl.panel.zoomLevel : ctrl.panel.tileServer.Options.options.maxZoom);\r\n        ctrl.panel.lockMap = (ctrl.panel.lockMap != undefined ? ctrl.panel.lockMap : 'No');\r\n        ctrl.panel.maxLongitude = (ctrl.panel.maxLongitude != undefined ? ctrl.panel.maxLongitude : -125);\r\n        ctrl.panel.maxLatitude = (ctrl.panel.maxLatitude != undefined ? ctrl.panel.maxLatitude : 24);\r\n        ctrl.panel.minLatitude = (ctrl.panel.minLatitude != undefined ? ctrl.panel.minLatitude : 50);\r\n        ctrl.panel.minLongitude = (ctrl.panel.minLongitude != undefined ? ctrl.panel.minLongitude : -66);\r\n        ctrl.panel.useReferenceValue = (ctrl.panel.useReferenceValue != undefined ? ctrl.panel.useReferenceValue : false);\r\n        ctrl.panel.referencePointTag = (ctrl.panel.referencePointTag != undefined ? ctrl.panel.referencePointTag : '');\r\n        ctrl.panel.useAngleMean = (ctrl.panel.useAngleMean != undefined ? ctrl.panel.useAngleMean : false);\r\n        ctrl.panel.angleMeanTimeWindow = (ctrl.panel.angleMeanTimeWindow != undefined ? ctrl.panel.angleMeanTimeWindow : '5');\r\n        ctrl.panel.showLegend = (ctrl.panel.showLegend != undefined ? ctrl.panel.showLegend : false);\r\n        ctrl.panel.useGradient = (ctrl.panel.useGradient != undefined ? ctrl.panel.useGradient : true);\r\n        ctrl.panel.gradientBreakCount = (ctrl.panel.gradientBreakCount != undefined ? ctrl.panel.gradientBreakCount : 10);\r\n        ctrl.panel.gradientStart = (ctrl.panel.gradientStart != undefined ? ctrl.panel.gradientStart : 0);\r\n        ctrl.panel.gradientEnd = (ctrl.panel.gradientEnd != undefined ? ctrl.panel.gradientEnd : 1000);\r\n        ctrl.panel.gradientStartColor = (ctrl.panel.gradientStartColor != undefined ? ctrl.panel.gradientStartColor : 'purple');\r\n        ctrl.panel.gradientEndColor = (ctrl.panel.gradientEndColor != undefined ? ctrl.panel.gradientEndColor : 'red');\r\n        ctrl.panel.gradientSigFigs = (ctrl.panel.gradientSigFigs != undefined ? ctrl.panel.gradientSigFigs : 2);\r\n\r\n\r\n        ctrl.metaData = null;\r\n        ctrl.data = [];\r\n        ctrl.circleMarkers = [];\r\n        ctrl.contourLayers = null;\r\n        ctrl.$scope.mapContainer == null;\r\n        ctrl.legend = null;\r\n\r\n\r\n    }\r\n\r\n    // #region Events from Graphana Handlers\r\n    onInitEditMode() {\r\n        this.addEditorTab('Options', 'public/plugins/gridprotectionalliance-contourmap-panel/partials/editor.html', 2);\n        this.addEditorTab('Colors', 'public/plugins/gridprotectionalliance-contourmap-panel/partials/colors.html', 3);\n        console.log('init-edit-mode');\r\n    }\r\n\r\n    onPanelTeardown() {\r\n        if (this.map) {\r\n            this.map.off('zoomend');\r\n            this.map.off('moveend');\r\n        }\r\n        console.log('panel-teardown');\r\n    }\r\n\r\n    onPanelInitialized() {\r\n        console.log('panel-initialized');\r\n    }\r\n\r\n    onRefresh() {\n        var ctrl = this;\n\n        if (ctrl.height > ctrl.row.height) ctrl.render();\n\n        console.log('refresh');\r\n    }\n\n    onResize() {\n        var ctrl = this;\n        console.log('refresh');\r\n    }\n\n    onRender() {\n        console.log('render');\r\n    }\n\n    onDataRecieved(data) {\n        var ctrl = this;\n\n        if (ctrl.$scope.mapContainer == null) ctrl.createMap();\n\n        if (ctrl.metaData == null || ctrl.panel.editMode) {\n            ctrl.metaData = [];\n            \n            ctrl.datasource.getMetaData(data.map(function(x) { return \"'\" + x.pointtag + \"'\"; }).join(',')).then(function (metaData) {\n                ctrl.metaData = JSON.parse(metaData.data);\n                _.each(ctrl.metaData, function (element, index, list) {\n                    var datam = _.find(data, function (y) {\n                        return element.PointTag == y.pointtag\n                    });\n\n                    if (datam.datapoints.length > 0)\n                        element.Value = datam.datapoints.pop()[0];\n                });\n                ctrl.plotSites();\n                ctrl.plotContour(data);\n\n            })\n        }\n        else {\n            _.each(ctrl.metaData, function (element, index, list) {\n                var datam = _.find(data, function(x) {\n                    return element.pointtag == data.pointtag\n                });\n\n                if (datam.datapoints.length > 0)\n                    element.Value = datam.datapoints.pop()[0];\n            });\n            ctrl.plotContour(data);\n        }\n\n    }\n\n    onDataError(msg) {\n        console.log('data-error');\r\n    }\n    // #endregion\n\r\n    // #region Map and Marker Creation\r\n    createMap() {\r\n        var ctrl = this;\r\n\r\n        if (ctrl.$scope.mapContainer == null) {\r\n\r\n            var mapOptions = {\r\n                zoomControl: false,\r\n                attributionControl: false,\r\n                boxZoom: false,\r\n                doubleClickZoom: false,\r\n                dragging: (ctrl.panel.lockMap == 'No'),\r\n                zoomDelta: (ctrl.panel.lockMap == 'No' ? 1 : 0),\r\n                minZoom: (ctrl.panel.lockMap == 'No' ? ctrl.panel.minZoom : ctrl.panel.zoomLevel),\r\n                maxZoom: (ctrl.panel.lockMap == 'No' ? ctrl.panel.maxZoom : ctrl.panel.zoomLevel)\r\n            };\r\n\r\n            ctrl.$scope.mapContainer = L.map('mapid_' + ctrl.panel.id, mapOptions);\r\n            ctrl.$scope.tileLayer = L.tileLayer(ctrl.panel.tileServer.Options.url, ctrl.panel.tileServer.Options.options);\r\n            ctrl.$scope.tileLayer.addTo(ctrl.$scope.mapContainer);\r\n            ctrl.updateMapView();\r\n\r\n            // setup map listeners\r\n            ctrl.$scope.mapContainer.off('zoomend');\r\n            ctrl.$scope.mapContainer.on('zoomend', function (event) {\r\n                ctrl.panel.zoomLevel = ctrl.$scope.mapContainer.getZoom();\r\n\r\n                var bounds = ctrl.$scope.mapContainer.getBounds();\r\n                ctrl.panel.maxLongitude = bounds._southWest.lng;\r\n                ctrl.panel.maxLatitude = bounds._northEast.lat;\r\n                ctrl.panel.minLatitude = bounds._southWest.lat;\r\n                ctrl.panel.minLongitude = bounds._northEast.lng;\r\n\r\n                ctrl.refresh();\r\n            });\r\n            ctrl.$scope.mapContainer.off('moveend');\r\n            ctrl.$scope.mapContainer.on('moveend', function (event) {\r\n                ctrl.panel.zoomLevel = ctrl.$scope.mapContainer.getZoom();\r\n\r\n                var bounds = ctrl.$scope.mapContainer.getBounds();\r\n                ctrl.panel.maxLongitude = bounds._southWest.lng;\r\n                ctrl.panel.maxLatitude = bounds._northEast.lat;\r\n                ctrl.panel.minLatitude = bounds._southWest.lat;\r\n                ctrl.panel.minLongitude = bounds._northEast.lng;\r\n\r\n                ctrl.refresh();\r\n            });\r\n\r\n        }\r\n    }\r\n\r\n    plotSites() {\r\n        var ctrl = this;\r\n        var options = {\r\n            radius: 4,             // Radius of the circle marker, in pixels\r\n            stroke: true,           // Whether to draw stroke along the path. Set it to false to disable borders on polygons or circles.\r\n            color: '#3388ff',       // Stroke color\r\n            weight: 1,              // Stroke width in pixels\r\n            opacity: 1.0,           // Stroke opacity\r\n            lineCap: 'round',       // A string that defines shape to be used at the end of the stroke.\r\n            lineJoin: 'round',      // A string that defines shape to be used at the corners of the stroke.\r\n            dashArray: null,        // A string that defines the stroke dash pattern. Doesn't work on Canvas-powered layers in some old browsers.\r\n            dashOffset: null,       // A string that defines the distance into the dash pattern to start the dash. Doesn't work on Canvas-powered layers in some old browsers.\r\n            fill: true,             // Whether to fill the path with color. Set it to false to disable filling on polygons or circles.\r\n            fillColor: '#3388ff',   // Fill color. Defaults to the value of the color option\r\n            fillOpacity: 0.2,       // Fill opacity.\r\n            fillRule: 'evenodd',    // A string that defines how the inside of a shape is determined.\r\n            bubblingMouseEvents: true,  // When true, a mouse event on this path will trigger the same event on the map (unless L.DomEvent.stopPropagation is used).\r\n            renderer: null,         // Use this specific instance of Renderer for this path. Takes precedence over the map's default renderer.\r\n            className: null         // \tCustom class name set on an element. Only for SVG renderer.\r\n        };\r\n\r\n        if (ctrl.circleMarkers.length > 0) ctrl.circleMarkers.map(a => { a.removeFrom(ctrl.$scope.mapContainer)})\r\n        _.each(ctrl.metaData, function (element, index, list) {\r\n            ctrl.circleMarkers.push(L.circleMarker([element.Latitude, element.Longitude], options).addTo(ctrl.$scope.mapContainer));\r\n        });\r\n    }\r\n\r\n    plotContour(data) {\r\n        var ctrl = this;\r\n\r\n        var m = $(this.$scope.mapContainer._container).height(),\r\n            n = $(this.$scope.mapContainer._container).width(),\r\n            values = new Array(parseInt((n * m).toFixed(0)));\r\n\r\n        var geoJson = this.createGeoJson(data);\r\n        var isoband = isobands(geoJson, geoJson.properties.breaks, geoJson.properties);\r\n\r\n        if (ctrl.contourLayers != null) ctrl.contourLayers.removeFrom(ctrl.$scope.mapContainer);\r\n\r\n        ctrl.contourLayers = L.geoJSON(isoband, {\r\n            style: function (feature) {\r\n                return feature.properties.style\r\n            }\r\n        }).addTo(ctrl.$scope.mapContainer);\r\n\r\n        ctrl.addLegend(isoband);\r\n\r\n    }\r\n\r\n    addLegend(data) {\r\n        var ctrl = this;\r\n\r\n        if (ctrl.legend != null) ctrl.legend.remove();\r\n\r\n        if (ctrl.panel.showLegend) {\r\n            ctrl.legend = L.control({ position: 'bottomright' });\r\n\r\n            ctrl.legend.onAdd = function (map) {\r\n\r\n                var div = L.DomUtil.create('div', 'info legend'),\r\n                    labels = data.features.map(a => { return a.properties.Value }),\r\n                    colors = data.features.map(a => { return a.properties.style.fillColor });\r\n\r\n                // loop through our density intervals and generate a label with a colored square for each interval\r\n                for (var i = 1; i < labels.length; i++) {\r\n                    div.innerHTML +=\r\n                        '<i style=\"background:' + colors[i] + '\"></i> ' +\r\n                        labels[i] + '<br>';\r\n                }\r\n\r\n                return div;\r\n            };\r\n\r\n            ctrl.legend.addTo(ctrl.$scope.mapContainer);\r\n        }\r\n    }\r\n    // #endregion\r\n\r\n    // #region Options Functions\r\n    changeMapBackground() {\r\n        var ctrl = this;\r\n\r\n        ctrl.$scope.tileLayer.remove();\r\n        ctrl.$scope.tileLayer = L.tileLayer(ctrl.panel.tileServer.Options.url, ctrl.panel.tileServer.Options.options);\r\n        ctrl.$scope.tileLayer.addTo(this.$scope.mapContainer);\r\n    }\r\n\r\n    updateZoom() {\r\n        var ctrl = this;\r\n\r\n        ctrl.$scope.mapContainer.options.minZoom = (ctrl.panel.lockMap == 'No' ? ctrl.panel.minZoom : ctrl.panel.zoomLevel);\r\n        ctrl.$scope.mapContainer.options.maxZoom = (ctrl.panel.lockMap == 'No' ? ctrl.panel.maxZoom : ctrl.panel.zoomLevel);\r\n\r\n        ctrl.$scope.mapContainer.setZoom(ctrl.panel.zoomLevel);\r\n    }\r\n\r\n    updateMapView() {\r\n        var ctrl = this;\r\n\r\n        ctrl.$scope.mapContainer.fitBounds([\r\n            [ctrl.panel.maxLatitude, ctrl.panel.maxLongitude],\r\n            [ctrl.panel.minLatitude, ctrl.panel.minLongitude]\r\n        ]);\r\n    }\r\n\r\n    lockMap() {\r\n        var ctrl = this;\r\n\r\n        ctrl.$scope.mapContainer.remove();\r\n        ctrl.$scope.mapContainer = null;\r\n        ctrl.createMap();\r\n    }\r\n\r\n    boundToMarkers() {\r\n        var ctrl = this;\r\n\r\n        var markerGroup = new L.featureGroup(ctrl.circleMarkers);\r\n        if (markerGroup.getBounds().isValid())\r\n            ctrl.$scope.mapContainer.fitBounds(markerGroup.getBounds());\r\n\r\n        var bounds = ctrl.$scope.mapContainer.getBounds();\r\n        ctrl.panel.maxLongitude = bounds._southWest.lng;\r\n        ctrl.panel.maxLatitude = bounds._northEast.lat;\r\n        ctrl.panel.minLatitude = bounds._southWest.lat;\r\n        ctrl.panel.minLongitude = bounds._northEast.lng;\r\n    }\r\n    //#endregion\r\n\r\n    // #region Angular Tag Functions\r\n    getRange(min, max, step) {\r\n        step = step || 1;\r\n        var input = [];\r\n        for (var i = min; i <= max; i = i + step) {\r\n            input.push(i);\r\n        }\r\n        return input;\r\n    }\r\n    // #endregion\r\n\r\n    //#region Misc\r\n    createGeoJson(data) {\r\n        var ctrl = this;\r\n        ctrl.average = this.metaData.map(a => { return a.Value }).reduce((a, b) => { return a + b }) / this.metaData.length;\r\n        var markerGroup = new L.featureGroup(ctrl.circleMarkers);\r\n        var bounds = markerGroup.getBounds();\r\n        var minLng = bounds._southWest.lng;\r\n        var minLat = bounds._southWest.lat;\r\n        var maxLng = bounds._northEast.lng;\r\n        var maxLat = bounds._northEast.lat;\r\n\r\n        var gridN = 20;\r\n        var gridM = 20;\r\n\r\n        var nStep = Math.abs(maxLng - minLng) / gridN;\r\n        var mStep = Math.abs(maxLat - minLat) / gridM;\r\n\r\n        var breaks = [-9999999999];\r\n        var color = d3.scaleLinear()\r\n            .domain([ctrl.panel.gradientStart, ctrl.panel.gradientEnd])\r\n            .range([ctrl.panel.gradientStartColor, ctrl.panel.gradientEndColor])\r\n            .interpolate(d3.interpolateCubehelixLong);\r\n\r\n        var styles = [{\r\n            \"style\": {\r\n                \"stroke\": 0,\r\n                \"fillColor\": \"white\",\r\n                \"opacity\": 0\r\n            }\r\n        }];\r\n\r\n        for (var i = ctrl.panel.gradientStart; i <= ctrl.panel.gradientEnd; i+= (ctrl.panel.gradientEnd - ctrl.panel.gradientStart)/ctrl.panel.gradientBreakCount) {\r\n            breaks.push(i.toFixed(ctrl.panel.gradientSigFigs));\r\n            styles.push({\r\n                \"style\": {\r\n                    \"stroke\": 0,\r\n                    \"fillColor\": color(i)\r\n                }\r\n            })\r\n\r\n        }\r\n\r\n\r\n\r\n        var geoJson = {\r\n            \"type\": 'FeatureCollection',\r\n            \"properties\": {\r\n                \"breaks\": breaks,\r\n                \"breaksProperties\": styles,\r\n                \"zProperty\": \"Value\"\r\n            },\r\n            \"features\": []\r\n        }\r\n\r\n        for (var i = minLng - nStep; i <= maxLng + nStep; i += nStep) {\r\n            for (var j = minLat - mStep; j <= maxLat + mStep; j += mStep) {\r\n\r\n                var wzSum = 0;\r\n                var wSum = 0;\r\n                _.each(ctrl.metaData, (element, index, list) => {\r\n                    wzSum += Math.abs( element.Value) / Math.pow(ctrl.getDistanceFromLatLonInKm(element.Latitude, element.Longitude, j, i),2);\r\n                    wSum += 1 / Math.pow(ctrl.getDistanceFromLatLonInKm(element.Latitude, element.Longitude, j, i), 2);\r\n                });\r\n\r\n                var value = wzSum/wSum;\r\n\r\n\r\n                if( i < minLng || i > maxLng || j < minLat || j > maxLat) value = -9999999999\r\n                var feature = {\r\n                    \"type\": \"Feature\",\r\n                    \"properties\": { Value: value},\r\n                    \"geometry\": {\r\n                        \"type\": \"Point\",\r\n                        \"coordinates\": [i, j]\r\n                    }\r\n                };\r\n\r\n                geoJson.features.push(feature)\r\n            }\r\n        }\r\n\r\n        return geoJson;\r\n    }\r\n\r\n    getDistanceFromLatLonInKm(lat1, lon1, lat2, lon2) {\r\n        var ctrl = this;\r\n\r\n        var R = 6371; // Radius of the earth in km\r\n        var dLat = ctrl.deg2rad(lat2 - lat1);  // deg2rad below\r\n        var dLon = ctrl.deg2rad(lon2 - lon1);\r\n        var a =\r\n            Math.sin(dLat / 2) * Math.sin(dLat / 2) +\r\n            Math.cos(ctrl.deg2rad(lat1)) * Math.cos(ctrl.deg2rad(lat2)) *\r\n            Math.sin(dLon / 2) * Math.sin(dLon / 2)\r\n            ;\r\n        var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\r\n        var d = R * c; // Distance in km\r\n        return (d < 1 ? 1 : d);\r\n    }\r\n\r\n    deg2rad(deg) {\r\n        return deg * (Math.PI / 180)\r\n    }\r\n\r\n\r\n    //#endregion\r\n\r\n}\r\n\r\nContourMapCtrl.templateUrl = 'partials/module.html';\r\n\r\n"]}