{"version":3,"sources":["../../src/controllers/contourMap_ctrl.js"],"names":["MetricsPanelCtrl","_","d3","moment","L","TileServers","isobands","ContourMapCtrl","$scope","$injector","ctrl","events","on","onInitEditMode","bind","onPanelTeardown","onRender","onPanelInitialized","onDataRecieved","onDataError","onRefresh","panel","tileServer","undefined","maxZoom","Options","options","minZoom","zoomLevel","lockMap","maxLongitude","maxLatitude","minLatitude","minLongitude","useReferenceValue","referencePointTag","useAngleMean","angleMeanTimeWindow","showLegend","showWeather","useGradient","gradientBreakCount","gradientStart","gradientEnd","gradientStartColor","gradientEndColor","gradientSigFigs","ySteps","xSteps","distancePower","overlap","data","circleMarkers","contourLayers","mapContainer","legend","addEditorTab","map","off","height","row","render","createMap","plotSites","plotContour","msg","mapOptions","zoomControl","attributionControl","boxZoom","doubleClickZoom","dragging","zoomDelta","id","tileLayer","url","addTo","updateMapView","event","getZoom","bounds","getBounds","_southWest","lng","_northEast","lat","refresh","radius","stroke","color","weight","opacity","lineCap","lineJoin","dashArray","dashOffset","fill","fillColor","fillOpacity","fillRule","bubblingMouseEvents","renderer","className","length","a","removeFrom","each","element","index","list","push","circleMarker","latitude","longitude","m","$","_container","n","width","values","Array","parseInt","toFixed","geoJson","createGeoJson","isoband","properties","breaks","geoJSON","style","feature","date","datapoints","remainder","minute","add","utc","format","ia_wms","remove","wms","layers","transparent","time","addLegend","control","position","onAdd","div","DomUtil","create","labels","features","Value","colors","i","innerHTML","setZoom","fitBounds","markerGroup","featureGroup","isValid","min","max","step","input","minLng","minLat","maxLng","maxLat","overlapLat","overlapLng","gridN","gridM","pow","nStep","Math","abs","mStep","scaleLinear","domain","range","interpolate","interpolateCubehelixLong","styles","j","wzSum","wSum","val","isNaN","getDistanceFromLatLonInKm","value","lat1","lon1","lat2","lon2","R","dLat","deg2rad","dLon","sin","cos","c","atan2","sqrt","d","deg","PI","templateUrl"],"mappings":"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","file":"contourMap_ctrl.js","sourcesContent":["﻿//******************************************************************************************************\r\n//  contourMap_ctrl.ts - Gbtc\r\n//\r\n//  Copyright © 2017, Grid Protection Alliance.  All Rights Reserved.\r\n//\r\n//  Licensed to the Grid Protection Alliance (GPA) under one or more contributor license agreements. See\r\n//  the NOTICE file distributed with this work for additional information regarding copyright ownership.\r\n//  The GPA licenses this file to you under the MIT License (MIT), the \"License\"; you may not use this\r\n//  file except in compliance with the License. You may obtain a copy of the License at:\r\n//\r\n//      http://opensource.org/licenses/MIT\r\n//\r\n//  Unless agreed to in writing, the subject software distributed under the License is distributed on an\r\n//  \"AS-IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. Refer to the\r\n//  License for the specific language governing permissions and limitations.\r\n//\r\n//  Code Modification History:\r\n//  ----------------------------------------------------------------------------------------------------\r\n//  11/08/2017 - Billy Ernest\r\n//       Generated original version of source code.\r\n//\r\n//******************************************************************************************************\r\n\r\nimport { MetricsPanelCtrl } from 'app/plugins/sdk'\r\n\r\nimport _ from 'lodash';\nimport d3 from \"d3\";\nimport moment from \"moment\";\n\nimport * as L from 'leaflet';\r\nimport './../css/leaflet.css!';\n\nimport { TileServers } from './../js/constants';\nimport isobands from \"@turf/isobands\"\n\r\nexport class ContourMapCtrl extends MetricsPanelCtrl {\r\n    constructor($scope, $injector) {\r\n        super($scope, $injector);\r\n\r\n        var ctrl = this;\r\n\r\n        this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\r\n        this.events.on('panel-teardown', this.onPanelTeardown.bind(this));\r\n        this.events.on('render', this.onRender.bind(this));\r\n        this.events.on('panel-initialized', this.onPanelInitialized.bind(this));\r\n        this.events.on('data-received', this.onDataRecieved.bind(this));\r\n        //this.events.on('data-snapshot-load', console.log('data-snapshot-load'));\r\n        this.events.on('data-error', this.onDataError.bind(this));\r\n        this.events.on('refresh', this.onRefresh.bind(this));\n\r\n\r\n        // Variables for options\r\n        ctrl.TileServers = TileServers;\r\n        ctrl.panel.tileServer = (ctrl.panel.tileServer != undefined ? ctrl.panel.tileServer: TileServers[0]);\r\n        ctrl.panel.maxZoom = (ctrl.panel.tileServer.Options.options.maxZoom != undefined ? ctrl.panel.tileServer.Options.options.maxZoom : 18)\r\n        ctrl.panel.minZoom = (ctrl.panel.tileServer.Options.options.minZoom != undefined ? ctrl.panel.tileServer.Options.options.minZoom : 2)\r\n        ctrl.panel.zoomLevel = (ctrl.panel.zoomLevel != undefined ? ctrl.panel.zoomLevel : ctrl.panel.tileServer.Options.options.maxZoom);\r\n        ctrl.panel.lockMap = (ctrl.panel.lockMap != undefined ? ctrl.panel.lockMap : 'No');\r\n        ctrl.panel.maxLongitude = (ctrl.panel.maxLongitude != undefined ? ctrl.panel.maxLongitude : -125);\r\n        ctrl.panel.maxLatitude = (ctrl.panel.maxLatitude != undefined ? ctrl.panel.maxLatitude : 24);\r\n        ctrl.panel.minLatitude = (ctrl.panel.minLatitude != undefined ? ctrl.panel.minLatitude : 50);\r\n        ctrl.panel.minLongitude = (ctrl.panel.minLongitude != undefined ? ctrl.panel.minLongitude : -66);\r\n        ctrl.panel.useReferenceValue = (ctrl.panel.useReferenceValue != undefined ? ctrl.panel.useReferenceValue : false);\r\n        ctrl.panel.referencePointTag = (ctrl.panel.referencePointTag != undefined ? ctrl.panel.referencePointTag : '');\r\n        ctrl.panel.useAngleMean = (ctrl.panel.useAngleMean != undefined ? ctrl.panel.useAngleMean : false);\r\n        ctrl.panel.angleMeanTimeWindow = (ctrl.panel.angleMeanTimeWindow != undefined ? ctrl.panel.angleMeanTimeWindow : '5');\r\n        ctrl.panel.showLegend = (ctrl.panel.showLegend != undefined ? ctrl.panel.showLegend : false);\r\n        ctrl.panel.showWeather = (ctrl.panel.showWeather != undefined ? ctrl.panel.showWeather : false);\r\n\r\n        ctrl.panel.useGradient = (ctrl.panel.useGradient != undefined ? ctrl.panel.useGradient : true);\r\n        ctrl.panel.gradientBreakCount = (ctrl.panel.gradientBreakCount != undefined ? ctrl.panel.gradientBreakCount : 10);\r\n        ctrl.panel.gradientStart = (ctrl.panel.gradientStart != undefined ? ctrl.panel.gradientStart : 0);\r\n        ctrl.panel.gradientEnd = (ctrl.panel.gradientEnd != undefined ? ctrl.panel.gradientEnd : 1000);\r\n        ctrl.panel.gradientStartColor = (ctrl.panel.gradientStartColor != undefined ? ctrl.panel.gradientStartColor : 'purple');\r\n        ctrl.panel.gradientEndColor = (ctrl.panel.gradientEndColor != undefined ? ctrl.panel.gradientEndColor : 'red');\r\n        ctrl.panel.gradientSigFigs = (ctrl.panel.gradientSigFigs != undefined ? ctrl.panel.gradientSigFigs : 2);\r\n\r\n        ctrl.panel.ySteps = (ctrl.panel.ySteps != undefined ? ctrl.panel.ySteps : 25);\r\n        ctrl.panel.xSteps = (ctrl.panel.xSteps != undefined ? ctrl.panel.xSteps : 35);\r\n        ctrl.panel.distancePower = (ctrl.panel.distancePower != undefined ? ctrl.panel.distancePower : 2);\r\n        ctrl.panel.overlap = (ctrl.panel.overlap != undefined ? ctrl.panel.overlap : 0);\r\n\r\n        ctrl.data = [];\r\n        ctrl.circleMarkers = [];\r\n        ctrl.contourLayers = null;\r\n        ctrl.$scope.mapContainer == null;\r\n        ctrl.legend = null;\r\n\r\n\r\n    }\r\n\r\n    // #region Events from Graphana Handlers\r\n    onInitEditMode() {\r\n        this.addEditorTab('Options', 'public/plugins/gridprotectionalliance-contourmap-panel/partials/editor.html', 2);\n        this.addEditorTab('Colors', 'public/plugins/gridprotectionalliance-contourmap-panel/partials/colors.html', 3);\n        //console.log('init-edit-mode');\r\n    }\r\n\r\n    onPanelTeardown() {\r\n        if (this.map) {\r\n            this.map.off('zoomend');\r\n            this.map.off('moveend');\r\n        }\r\n        //console.log('panel-teardown');\r\n    }\r\n\r\n    onPanelInitialized() {\r\n        //console.log('panel-initialized');\r\n    }\r\n\r\n    onRefresh() {\n        var ctrl = this;\n\n        if (ctrl.height > ctrl.row.height) ctrl.render();\n\n        //console.log('refresh');\r\n    }\n\n    onResize() {\n        var ctrl = this;\n        //console.log('refresh');\r\n    }\n\n    onRender() {\n        //console.log('render');\r\n    }\n\n    onDataRecieved(data) {\n        var ctrl = this;\n\n        if (ctrl.$scope.mapContainer == null) ctrl.createMap();\n\n        ctrl.plotSites(data);\r\n        ctrl.plotContour(data);\n    }\n\n    onDataError(msg) {\n        //console.log('data-error');\r\n    }\n    // #endregion\n\r\n    // #region Map and Marker Creation\r\n    createMap() {\r\n        var ctrl = this;\r\n\r\n        if (ctrl.$scope.mapContainer == null) {\r\n\r\n            var mapOptions = {\r\n                zoomControl: false,\r\n                attributionControl: false,\r\n                boxZoom: false,\r\n                doubleClickZoom: false,\r\n                dragging: (ctrl.panel.lockMap == 'No'),\r\n                zoomDelta: (ctrl.panel.lockMap == 'No' ? 1 : 0),\r\n                minZoom: (ctrl.panel.lockMap == 'No' ? ctrl.panel.minZoom : ctrl.panel.zoomLevel),\r\n                maxZoom: (ctrl.panel.lockMap == 'No' ? ctrl.panel.maxZoom : ctrl.panel.zoomLevel)\r\n            };\r\n\r\n            ctrl.$scope.mapContainer = L.map('mapid_' + ctrl.panel.id, mapOptions);\r\n            ctrl.$scope.tileLayer = L.tileLayer(ctrl.panel.tileServer.Options.url, ctrl.panel.tileServer.Options.options);\r\n            ctrl.$scope.tileLayer.addTo(ctrl.$scope.mapContainer);\r\n            ctrl.updateMapView();\r\n\r\n            // setup map listeners\r\n            ctrl.$scope.mapContainer.off('zoomend');\r\n            ctrl.$scope.mapContainer.on('zoomend', function (event) {\r\n                ctrl.panel.zoomLevel = ctrl.$scope.mapContainer.getZoom();\r\n\r\n                var bounds = ctrl.$scope.mapContainer.getBounds();\r\n                ctrl.panel.maxLongitude = bounds._southWest.lng;\r\n                ctrl.panel.maxLatitude = bounds._northEast.lat;\r\n                ctrl.panel.minLatitude = bounds._southWest.lat;\r\n                ctrl.panel.minLongitude = bounds._northEast.lng;\r\n\r\n                ctrl.refresh();\r\n            });\r\n            ctrl.$scope.mapContainer.off('moveend');\r\n            ctrl.$scope.mapContainer.on('moveend', function (event) {\r\n                ctrl.panel.zoomLevel = ctrl.$scope.mapContainer.getZoom();\r\n\r\n                var bounds = ctrl.$scope.mapContainer.getBounds();\r\n                ctrl.panel.maxLongitude = bounds._southWest.lng;\r\n                ctrl.panel.maxLatitude = bounds._northEast.lat;\r\n                ctrl.panel.minLatitude = bounds._southWest.lat;\r\n                ctrl.panel.minLongitude = bounds._northEast.lng;\r\n\r\n                ctrl.refresh();\r\n            });\r\n\r\n        }\r\n    }\r\n\r\n    plotSites(data) {\r\n        var ctrl = this;\r\n        var options = {\r\n            radius: 4,             // Radius of the circle marker, in pixels\r\n            stroke: true,           // Whether to draw stroke along the path. Set it to false to disable borders on polygons or circles.\r\n            color: '#3388ff',       // Stroke color\r\n            weight: 1,              // Stroke width in pixels\r\n            opacity: 1.0,           // Stroke opacity\r\n            lineCap: 'round',       // A string that defines shape to be used at the end of the stroke.\r\n            lineJoin: 'round',      // A string that defines shape to be used at the corners of the stroke.\r\n            dashArray: null,        // A string that defines the stroke dash pattern. Doesn't work on Canvas-powered layers in some old browsers.\r\n            dashOffset: null,       // A string that defines the distance into the dash pattern to start the dash. Doesn't work on Canvas-powered layers in some old browsers.\r\n            fill: true,             // Whether to fill the path with color. Set it to false to disable filling on polygons or circles.\r\n            fillColor: '#3388ff',   // Fill color. Defaults to the value of the color option\r\n            fillOpacity: 0.2,       // Fill opacity.\r\n            fillRule: 'evenodd',    // A string that defines how the inside of a shape is determined.\r\n            bubblingMouseEvents: true,  // When true, a mouse event on this path will trigger the same event on the map (unless L.DomEvent.stopPropagation is used).\r\n            renderer: null,         // Use this specific instance of Renderer for this path. Takes precedence over the map's default renderer.\r\n            className: null         // \tCustom class name set on an element. Only for SVG renderer.\r\n        };\r\n\r\n        if (ctrl.circleMarkers.length > 0) ctrl.circleMarkers.map(a => { a.removeFrom(ctrl.$scope.mapContainer) })\r\n        ctrl.circleMarkers = [];\r\n        _.each(data, function (element, index, list) {\r\n            ctrl.circleMarkers.push(L.circleMarker([element.latitude, element.longitude], options).addTo(ctrl.$scope.mapContainer));\r\n        });\r\n    }\r\n\r\n    plotContour(data) {\r\n        var ctrl = this;\r\n\r\n        if (ctrl.contourLayers != null) ctrl.contourLayers.removeFrom(ctrl.$scope.mapContainer);\r\n\r\n        if (data.length < 2) return;\r\n\r\n\r\n        var m = $(this.$scope.mapContainer._container).height(),\r\n            n = $(this.$scope.mapContainer._container).width(),\r\n            values = new Array(parseInt((n * m).toFixed(0)));\r\n\r\n        var geoJson = this.createGeoJson(data);\r\n        var isoband = isobands(geoJson, geoJson.properties.breaks, geoJson.properties);\r\n\r\n\r\n        ctrl.contourLayers = L.geoJSON(isoband, {\r\n            style: function (feature) {\r\n                return feature.properties.style\r\n            }\r\n        }).addTo(ctrl.$scope.mapContainer);\r\n\r\n        var date = (data[0].datapoints.length > 0 ? moment(data[0].datapoints[data[0].datapoints.length - 1][1]) : moment());\r\n        var remainder = date.minute() % 5;\r\n        date = moment(date).add(\"minutes\", -remainder).utc().format(\"YYYY-MM-DDTHH:mm\");\r\n\r\n        if (ctrl.ia_wms != null) ctrl.ia_wms.remove();\r\n\r\n        if(ctrl.panel.showWeather)\r\n            ctrl.ia_wms = L.tileLayer.wms(\"https://mesonet.agron.iastate.edu/cgi-bin/wms/nexrad/n0r-t.cgi?\", { layers: \"nexrad-n0r-wmst\", transparent: true, format: 'image/png', time: date}).addTo(ctrl.$scope.mapContainer);\r\n\r\n        ctrl.addLegend(isoband);\r\n\r\n    }\r\n\r\n    addLegend(data) {\r\n        var ctrl = this;\r\n\r\n        if (ctrl.legend != null) ctrl.legend.remove();\r\n\r\n        if (ctrl.panel.showLegend) {\r\n            ctrl.legend = L.control({ position: 'bottomright' });\r\n\r\n            ctrl.legend.onAdd = function (map) {\r\n\r\n                var div = L.DomUtil.create('div', 'info legend'),\r\n                    labels = data.features.map(a => { return a.properties.Value }),\r\n                    colors = data.features.map(a => { return a.properties.style.fillColor });\r\n\r\n                // loop through our density intervals and generate a label with a colored square for each interval\r\n                for (var i = 1; i < labels.length; i++) {\r\n                    div.innerHTML +=\r\n                        '<i style=\"background:' + colors[i] + '\"></i> ' +\r\n                        labels[i] + '<br>';\r\n                }\r\n\r\n                return div;\r\n            };\r\n\r\n            ctrl.legend.addTo(ctrl.$scope.mapContainer);\r\n        }\r\n    }\r\n    // #endregion\r\n\r\n    // #region Options Functions\r\n    changeMapBackground() {\r\n        var ctrl = this;\r\n\r\n        ctrl.$scope.tileLayer.remove();\r\n        ctrl.$scope.tileLayer = L.tileLayer(ctrl.panel.tileServer.Options.url, ctrl.panel.tileServer.Options.options);\r\n        ctrl.$scope.tileLayer.addTo(this.$scope.mapContainer);\r\n    }\r\n\r\n    updateZoom() {\r\n        var ctrl = this;\r\n\r\n        ctrl.$scope.mapContainer.options.minZoom = (ctrl.panel.lockMap == 'No' ? ctrl.panel.minZoom : ctrl.panel.zoomLevel);\r\n        ctrl.$scope.mapContainer.options.maxZoom = (ctrl.panel.lockMap == 'No' ? ctrl.panel.maxZoom : ctrl.panel.zoomLevel);\r\n\r\n        ctrl.$scope.mapContainer.setZoom(ctrl.panel.zoomLevel);\r\n    }\r\n\r\n    updateMapView() {\r\n        var ctrl = this;\r\n\r\n        ctrl.$scope.mapContainer.fitBounds([\r\n            [ctrl.panel.maxLatitude, ctrl.panel.maxLongitude],\r\n            [ctrl.panel.minLatitude, ctrl.panel.minLongitude]\r\n        ]);\r\n    }\r\n\r\n    lockMap() {\r\n        var ctrl = this;\r\n\r\n        ctrl.$scope.mapContainer.remove();\r\n        ctrl.$scope.mapContainer = null;\r\n        ctrl.createMap();\r\n    }\r\n\r\n    boundToMarkers() {\r\n        var ctrl = this;\r\n\r\n        var markerGroup = new L.featureGroup(ctrl.circleMarkers);\r\n        if (markerGroup.getBounds().isValid())\r\n            ctrl.$scope.mapContainer.fitBounds(markerGroup.getBounds());\r\n\r\n        var bounds = ctrl.$scope.mapContainer.getBounds();\r\n        ctrl.panel.maxLongitude = bounds._southWest.lng;\r\n        ctrl.panel.maxLatitude = bounds._northEast.lat;\r\n        ctrl.panel.minLatitude = bounds._southWest.lat;\r\n        ctrl.panel.minLongitude = bounds._northEast.lng;\r\n    }\r\n    //#endregion\r\n\r\n    // #region Angular Tag Functions\r\n    getRange(min, max, step) {\r\n        step = step || 1;\r\n        var input = [];\r\n        for (var i = min; i <= max; i = i + step) {\r\n            input.push(i);\r\n        }\r\n        return input;\r\n    }\r\n    // #endregion\r\n\r\n    //#region Misc\r\n    createGeoJson(data) {\r\n        var ctrl = this;\r\n\r\n        var minLng = d3.min(data, function (a) { return a.longitude });\r\n        var minLat = d3.min(data, function (a) { return a.latitude  });\r\n        var maxLng = d3.max(data, function (a) { return a.longitude });\r\n        var maxLat = d3.max(data, function (a) { return a.latitude });\r\n\r\n        var overlapLat = (maxLat - minLat) * ctrl.panel.overlap/100;\r\n        var overlapLng = (maxLng - minLng) * ctrl.panel.overlap/100;\r\n\r\n        minLng -= overlapLng;\r\n        maxLng += overlapLng;\r\n        minLat -= overlapLat;\r\n        maxLat += overlapLat;\r\n\r\n        var gridN = ctrl.panel.xSteps;\r\n        var gridM = ctrl.panel.ySteps;\r\n        var pow = ctrl.panel.distancePower;\r\n\r\n        var nStep = Math.abs(maxLng - minLng) / gridN;\r\n        var mStep = Math.abs(maxLat - minLat) / gridM;\r\n\r\n        var breaks = [-9999999999];\r\n        var color = d3.scaleLinear()\r\n            .domain([ctrl.panel.gradientStart, ctrl.panel.gradientEnd])\r\n            .range([ctrl.panel.gradientStartColor, ctrl.panel.gradientEndColor])\r\n            .interpolate(d3.interpolateCubehelixLong);\r\n\r\n        var styles = [{\r\n            \"style\": {\r\n                \"stroke\": 0,\r\n                \"fillColor\": \"white\",\r\n                \"opacity\": 0\r\n            }\r\n        }];\r\n\r\n        for (var i = ctrl.panel.gradientStart; i <= ctrl.panel.gradientEnd; i+= (ctrl.panel.gradientEnd - ctrl.panel.gradientStart)/ctrl.panel.gradientBreakCount) {\r\n            breaks.push(i.toFixed(ctrl.panel.gradientSigFigs));\r\n            styles.push({\r\n                \"style\": {\r\n                    \"stroke\": 0,\r\n                    \"fillColor\": color(i)\r\n                }\r\n            })\r\n\r\n        }\r\n\r\n\r\n\r\n        var geoJson = {\r\n            \"type\": 'FeatureCollection',\r\n            \"properties\": {\r\n                \"breaks\": breaks,\r\n                \"breaksProperties\": styles,\r\n                \"zProperty\": \"Value\"\r\n            },\r\n            \"features\": []\r\n        }\r\n\r\n        for (var i = minLng - nStep; i <= maxLng + nStep; i += nStep) {\r\n            for (var j = minLat - mStep; j <= maxLat + mStep; j += mStep) {\r\n\r\n                var wzSum = 0;\r\n                var wSum = 0;\r\n                _.each(data, (element, index, list) => {\r\n                    var val = element.datapoints[element.datapoints.length - 1][0];\r\n                    if (isNaN(val))\r\n                        return;\r\n                    wzSum += val / Math.pow(ctrl.getDistanceFromLatLonInKm(element.latitude, element.longitude, j, i),pow);\r\n                    wSum += 1 / Math.pow(ctrl.getDistanceFromLatLonInKm(element.latitude, element.longitude, j, i),pow);\r\n                });\r\n\r\n                var value = wzSum/wSum;\r\n\r\n\r\n                if( i < minLng || i > maxLng || j < minLat || j > maxLat) value = -9999999999\r\n                var feature = {\r\n                    \"type\": \"Feature\",\r\n                    \"properties\": { Value: value},\r\n                    \"geometry\": {\r\n                        \"type\": \"Point\",\r\n                        \"coordinates\": [i, j]\r\n                    }\r\n                };\r\n\r\n                geoJson.features.push(feature)\r\n            }\r\n        }\r\n\r\n        return geoJson;\r\n    }\r\n\r\n    getDistanceFromLatLonInKm(lat1, lon1, lat2, lon2) {\r\n        var ctrl = this;\r\n\r\n        var R = 6371; // Radius of the earth in km\r\n        var dLat = ctrl.deg2rad(lat2 - lat1);  // deg2rad below\r\n        var dLon = ctrl.deg2rad(lon2 - lon1);\r\n        var a =\r\n            Math.sin(dLat / 2) * Math.sin(dLat / 2) +\r\n            Math.cos(ctrl.deg2rad(lat1)) * Math.cos(ctrl.deg2rad(lat2)) *\r\n            Math.sin(dLon / 2) * Math.sin(dLon / 2)\r\n            ;\r\n        var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\r\n        var d = R * c; // Distance in km\r\n        return (d < 1 ? 1 : d);\r\n    }\r\n\r\n    deg2rad(deg) {\r\n        return deg * (Math.PI / 180)\r\n    }\r\n\r\n\r\n    //#endregion\r\n\r\n}\r\n\r\nContourMapCtrl.templateUrl = 'partials/module.html';\r\n\r\n"]}